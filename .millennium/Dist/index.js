const MILLENNIUM_IS_CLIENT_MODULE=!0,pluginName="steam-game-helper";function InitializePlugins(){var e,t;let n;(e=window.PLUGIN_LIST||(window.PLUGIN_LIST={}))[pluginName]||(e[pluginName]={}),(t=window.MILLENNIUM_PLUGIN_SETTINGS_STORE||(window.MILLENNIUM_PLUGIN_SETTINGS_STORE={}))[pluginName]||(t[pluginName]={}),window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS||(window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS={}),function(e){e[e.CallServerMethod=0]="CallServerMethod"}(n||(n={}));let a=window.MILLENNIUM_PLUGIN_SETTINGS_STORE[pluginName],i=`Millennium.Internal.IPC.[${pluginName}]`;const o={DropDown:["string","number","boolean"],NumberTextInput:["number"],StringTextInput:["string"],FloatTextInput:["number"],CheckBox:["boolean"],NumberSlider:["number"],FloatSlider:["number"]};function l(e,t,a){return MILLENNIUM_BACKEND_IPC.postMessage(n.CallServerMethod,{pluginName:e,methodName:"__builtins__.__update_settings_value__",argumentList:{name:t,value:a}})}a.ignoreProxyFlag=!1,async function(){for(;"undefined"==typeof MainWindowBrowserManager;)await new Promise(e=>setTimeout(e,0));MainWindowBrowserManager?.m_browser?.on("message",(e,t)=>{if(e!==i)return;const{name:n,value:o}=JSON.parse(t);a.ignoreProxyFlag=!0,a.settingsStore[n]=o,l(pluginName,n,o),a.ignoreProxyFlag=!1})}();const r=e=>new Proxy(e,{set(e,t,n){if(!(t in e))throw new TypeError(`Property ${String(t)} does not exist on plugin settings`);const r=o[e[t].type],s=e[t]?.range;if(r.includes("number")&&"number"==typeof n&&(s&&(n=function(e,t,n){return Math.max(t,Math.min(n,e))}(n,s[0],s[1])),n||(n=0)),!r.includes(typeof n))throw new TypeError(`Expected ${r.join(" or ")}, got ${typeof n}`);return e[t].value=n,((e,t)=>{a.ignoreProxyFlag||(l(pluginName,e,t),"undefined"!=typeof MainWindowBrowserManager&&MainWindowBrowserManager?.m_browser?.PostMessage(i,JSON.stringify({name:e,value:t})))})(String(t),n),!0},get:(e,t)=>"__raw_get_internals__"===t?e:t in e?e[t].value:void 0});a.DefinePluginSetting=r,a.settingsStore=r({})}InitializePlugins();const __call_server_method__=(e,t)=>Millennium.callServerMethod(pluginName,e,t),__wrapped_callable__=e=>MILLENNIUM_API.callable(__call_server_method__,e);let PluginEntryPointMain=function(){return function(e,t,n,a){"use strict";const i=__wrapped_callable__("Backend.get_review"),o=__wrapped_callable__("Backend.save_review"),l=__wrapped_callable__("Backend.delete_review"),r=__wrapped_callable__("Backend.debug_log"),s=__wrapped_callable__("Backend.get_game_image_base64"),d=__wrapped_callable__("Backend.get_game_ratings"),p=async(e,n=document)=>[...await t.Millennium.findElement(n,e)][0],c=[{value:"IN_PROGRESS",label:"В процессе"},{value:"FINISHED",label:"Пройдена"},{value:"SKIPPED",label:"Пропущена"}],m=({games:e,onClose:n})=>{const[i,o]=a.useState(!1),[l,d]=a.useState(null),[p,c]=a.useState(0),[m,g]=a.useState(!1),[w,u]=a.useState(null),[_,E]=a.useState(!0);a.useEffect(()=>{_&&e.length>0&&0===e.filter(e=>e.installed).length&&(E(!1),alert("No installed games found in this collection. Showing all games instead."))},[_,e]);const f=_?e.filter(e=>e.installed):e,h=360/f.length;return window.SP_REACT.createElement(t.ModalRoot,{closeModal:n},window.SP_REACT.createElement("div",{style:{padding:"20px",minWidth:"800px",minHeight:"600px",display:"flex",flexDirection:"column",alignItems:"center"}},window.SP_REACT.createElement("h2",{style:{marginBottom:"20px"}},"Fortune Wheel - Choose Your Game!"),window.SP_REACT.createElement("div",{style:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center"}},window.SP_REACT.createElement("div",{style:{width:"60%",display:"flex",justifyContent:"center",alignItems:"center",position:"relative"}},window.SP_REACT.createElement("div",{style:{width:"400px",height:"400px",borderRadius:"50%",border:"8px solid #333",position:"relative",overflow:"hidden",transform:`rotate(${p}deg)`,transition:i?"transform 10000ms cubic-bezier(0.25, 0.46, 0.45, 0.94)":"none",background:"conic-gradient("+f.map((e,t)=>`hsl(${360*t/f.length}, 63%, 52%) ${t*h}deg ${(t+1)*h}deg`).join(", ")+")"}},f.map((e,t)=>{const n=t*h+h/2,a=n*Math.PI/180,i=200+130*Math.cos(a),o=200+130*Math.sin(a),l=n>90&&n<270;return window.SP_REACT.createElement("div",{key:e.appid,style:{position:"absolute",left:`${i}px`,top:`${o}px`,transform:`translate(-50%, -50%) rotate(${l?n+180:n}deg)`,transformOrigin:"center",display:"flex",alignItems:"center",justifyContent:"center"}},window.SP_REACT.createElement("span",{style:{fontSize:"11px",fontWeight:"bold",color:"white",textShadow:"1px 1px 2px rgba(0,0,0,0.8)",maxWidth:"80px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"center"}},e.display_name))})),window.SP_REACT.createElement("div",{style:{position:"absolute",top:"-10px",left:"50%",transform:"translateX(-50%)",width:"0",height:"0",borderTop:"25px solid rgb(243, 179, 105)",borderLeft:"15px solid transparent",borderRight:"15px solid transparent",zIndex:100}})),window.SP_REACT.createElement("div",{style:{width:"35%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"300px"}},m&&l?window.SP_REACT.createElement("div",{style:{textAlign:"center"}},window.SP_REACT.createElement("h3",{style:{marginBottom:"5px",color:"#28a745"}},"Selected Game!"),w?window.SP_REACT.createElement("img",{src:w,alt:l.display_name,style:{width:"200px",height:"300px",objectFit:"cover",borderRadius:"8px",marginBottom:"10px"}}):window.SP_REACT.createElement("div",{style:{width:"200px",height:"300px",backgroundColor:"#333",borderRadius:"8px",marginBottom:"10px",display:"flex",alignItems:"center",justifyContent:"center",color:"#666",fontSize:"12px"}},"No Image"),window.SP_REACT.createElement("h4",{style:{marginBottom:"20px"}},l.display_name)):window.SP_REACT.createElement("div",{style:{textAlign:"center",color:"#666"}},window.SP_REACT.createElement("h3",null,"Ready to spin?"),window.SP_REACT.createElement("p",null,"Click the Spin button to choose a random game from your collection!")))),window.SP_REACT.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginTop:"15px",justifyContent:"center"}},window.SP_REACT.createElement("label",{style:{fontSize:"14px",fontWeight:"bold"}},"Installed games only:"),window.SP_REACT.createElement("input",{type:"checkbox",defaultChecked:!0,checked:_,onChange:e=>E(e.target.checked),style:{width:"18px",height:"18px",cursor:"pointer"}}),` (Total: ${_?f.length:e.length})`),window.SP_REACT.createElement("div",{style:{display:"flex",gap:"15px",marginTop:"20px",justifyContent:"center"}},window.SP_REACT.createElement(t.DialogButton,{onClick:()=>{if(i||0===f.length)return void(0===f.length&&_&&alert("No installed games found in this collection. Please uncheck 'Show only installed games' to see all games."));o(!0),g(!1),d(null),u(null);const e=8*Math.random()+15,t=p+360*e;c(t);const n=(270-t%360+360)%360,a=Math.floor(n/h)%f.length,l=f[a];setTimeout(async()=>{if(d(l),g(!0),o(!1),l.header_filename){await r({message:`Loading image for game: ${l.display_name}, appId: ${l.appid}, filename: ${l.header_filename}`});const e=await(async(e,t)=>{try{const n=await s({app_id:e.toString(),file_name:t});return await r({message:`Image base64 for app ${e}, file ${t}: ${n?"received":"null"}`}),n}catch(t){return await r({message:`Error getting image base64 for app ${e}: ${t}`}),null}})(l.appid,l.header_filename);await r({message:`>> Final image url: ${e}`}),u(e)}else await r({message:`No header_filename for game: ${l.display_name}`}),u(null)},1e4)},disabled:i||0===f.length,style:{backgroundColor:i?"#6c757d":0===f.length?"#dc3545":"#007bff",color:"white",border:"none",padding:"10px 20px",borderRadius:"4px",cursor:i||0===f.length?"not-allowed":"pointer",opacity:i||0===f.length?.6:1,fontSize:"16px",fontWeight:"bold"}},i?"Spinning...":0===f.length?"No Games Available":"Spin"),m&&l&&window.SP_REACT.createElement(t.DialogButton,{onClick:()=>{l&&(SteamUIStore.Navigate(`/library/app/${l.appid}`),n())},style:{backgroundColor:"#28a745",color:"white",border:"none",padding:"10px 20px",borderRadius:"4px",cursor:"pointer",fontSize:"16px",fontWeight:"bold"}},"View Game"))))},g=({appId:e,onClose:n})=>{const[s,d]=a.useState(""),[p,m]=a.useState(0),[g,w]=a.useState("IN_PROGRESS"),[u,_]=a.useState(""),[E,f]=a.useState(""),[h,S]=a.useState(!0),[y,x]=a.useState(!1),[C,v]=a.useState(!1),[b,P]=a.useState(!1),[R,T]=a.useState(null);a.useEffect(()=>{(async()=>{try{const t=await i({app_id:e});await r({message:`Raw review data received: ${t}`});const n=JSON.parse(t);if(await r({message:`Parsed review data: ${JSON.stringify(n)}`}),T(n),n.review){const e=(e=>{try{return"string"!=typeof e?e:e.includes("\\u")?e.replace(/\\u[\dA-F]{4}/gi,e=>String.fromCharCode(parseInt(e.replace(/\\u/g,""),16))):e}catch(t){return console.error("Error decoding UTF-8 string:",t),e}})(n.review),t=(e=>{try{if("string"!=typeof e)return e;const t=new TextEncoder,n=new TextDecoder("utf-8"),a=t.encode(e);return n.decode(a)}catch(t){return console.error("Error forcing UTF-8 encoding:",t),e}})((e=>{try{if("string"!=typeof e)return e;if(e.includes("Ð")||e.includes("Ñ")||e.includes("Ð°")||e.includes("Ð¸")){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);const n=new TextDecoder("utf-8").decode(t),a=/[а-яё]/i;if(a.test(n)&&!a.test(e))return n}return e}catch(t){return console.error("Error fixing corrupted encoding:",t),e}})(e));await r({message:`Original review text: ${n.review}`}),await r({message:`After forceUtf8Encoding: ${t}`}),d(t),await r({message:`Final review text set: ${t}`})}n.rating&&(m(n.rating),await r({message:`Set rating: ${n.rating}`})),n.status&&(w(n.status),await r({message:`Set status: ${n.status}`})),n.created_at_formatted&&(f(n.created_at_formatted),await r({message:`Set created date: ${n.created_at_formatted}`})),n.finished_at_formatted&&(_(n.finished_at_formatted),await r({message:`Set finished date: ${n.finished_at_formatted}`}))}catch(e){await r({message:`Error loading review: ${e}`})}finally{S(!1)}})()},[e]);const A=()=>!R||s!==(R.review||"")||p!==(R.rating||0)||g!==(R.status||"IN_PROGRESS")||u!==(R.finished_at_formatted||"");return a.useEffect(()=>{A()&&(v(!1),P(!1))},[s,p,g,u]),h?window.SP_REACT.createElement(t.ModalRoot,{closeModal:n},window.SP_REACT.createElement("div",null,"Loading...")):window.SP_REACT.createElement(t.ModalRoot,{closeModal:n},window.SP_REACT.createElement("div",{style:{padding:"10px",minWidth:"500px"}},window.SP_REACT.createElement("h2",{style:{marginBottom:"20px"}},"Game Review"),window.SP_REACT.createElement("div",{style:{marginBottom:"15px"}},window.SP_REACT.createElement("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"}},"Review:"),window.SP_REACT.createElement("textarea",{value:s,onChange:e=>d(e.target.value),placeholder:"Write your game review...",style:{width:"95%",height:"120px",padding:"8px",border:"1px solid #ccc",borderRadius:"4px",resize:"vertical",fontFamily:"inherit"}})),window.SP_REACT.createElement("div",{style:{marginBottom:"15px"}},window.SP_REACT.createElement("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"}},"Rating (1-5):"),window.SP_REACT.createElement("div",{style:{display:"flex",gap:"10px",alignItems:"center"}},window.SP_REACT.createElement("input",{type:"range",min:"1",max:"5",step:"0.1",value:p||1,onChange:e=>m(parseFloat(e.target.value)),style:{flex:1,height:"20px",background:"background: linear-gradient(15deg, red, green)",outline:"none",borderRadius:"10px",cursor:"pointer"}}),window.SP_REACT.createElement("span",{style:{minWidth:"60px",textAlign:"center",fontWeight:"bold",color:(e=>e<=2?"#dc3545":e<=3.5?"#ffc107":e<=4.5?"#10A532":"#5281E6")(p||1)}},p>0?`${p}/5`:"1/5"))),window.SP_REACT.createElement("div",{style:{marginBottom:"15px"}},window.SP_REACT.createElement("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"}},"Game Status:"),window.SP_REACT.createElement("select",{value:g,onChange:e=>w(e.target.value),style:{width:"97%",padding:"8px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px"}},c.map(e=>window.SP_REACT.createElement("option",{key:e.value,value:e.value},e.label)))),"FINISHED"===g&&window.SP_REACT.createElement("div",{style:{marginBottom:"15px"}},window.SP_REACT.createElement("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"}},"Finished Date:"),window.SP_REACT.createElement("input",{type:"date",value:u,onChange:e=>_(e.target.value),style:{width:"95%",padding:"8px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px"}})),window.SP_REACT.createElement("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",alignItems:"center"}},window.SP_REACT.createElement(t.DialogButton,{onClick:async()=>{x(!0);try{const t={review:s,rating:p,status:g};"FINISHED"===g&&u&&(t.finished_at_formatted=u,await r({message:`Adding finished date: ${u}`}));const n=collectionStore.GetCollection(uiStore.currentGameListSelection.strCollectionId);if(n&&n.allApps){const a=n.allApps.map(e=>({appid:e.appid,display_name:e.display_name,icon_hash:e.icon_hash})).find(t=>t.appid===e);t.display_name=a.display_name,t.icon_hash=a.icon_hash}await r({message:`Saving review data: ${JSON.stringify(t)}`}),await o({app_id:e,review_data:JSON.stringify(t)})?(await r({message:"Review saved successfully"}),v(!0),P(!1),T({review:s,rating:p,status:g})):await r({message:"Failed to save review"})}catch(e){await r({message:`Error saving review: ${e}`})}finally{x(!1)}},disabled:y||!A(),style:{backgroundColor:C?"#28a745":"#007bff",color:"white",border:"none",padding:"8px 12px",borderRadius:"4px",cursor:y||!A()?"not-allowed":"pointer",opacity:y||!A()?.6:1,display:"flex",alignItems:"center",justifyContent:"center",width:"85%",height:"30px",fontSize:"14px",gap:"5px"}},y?"Saving...":C?"Saved ✓":"Save"),window.SP_REACT.createElement("button",{onClick:async()=>{try{await l({app_id:e})&&(await r({message:"Review deleted successfully"}),P(!0),v(!1),d(""),m(0),w("IN_PROGRESS"),_(""),f(""),T({}))}catch(e){await r({message:`Error deleting review: ${e}`})}},style:{backgroundColor:b?"#28a745":"#dc3545",color:"white",border:"none",padding:"8px 12px",borderRadius:"4px",fontSize:"14px",width:"15%",height:"45px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"5px"},title:b?"Review deleted":"Delete review"},b?"🗑️✓":"🗑️"))))},w=({onClose:e})=>{const[n,i]=a.useState(null),[o,l]=a.useState(!0),[s,p]=a.useState(!0),[m,g]=a.useState("all"),[w,u]=a.useState([]);a.useEffect(()=>{(async()=>{try{l(!0);const e={show_all_games:s};"all"!==m&&(e.selected_year=m),await r({message:`Loading ratings with params: ${JSON.stringify(e)}`});const t=await d(e),n=JSON.parse(t);i(n),u(n.years||[]),await r({message:`Loaded ${n.total_games} game ratings for ${n.years?.length||0} years`})}catch(e){await r({message:`Error loading game ratings: ${e}`})}finally{l(!1)}})()},[s,m]);const _=e=>{switch(e){case"FINISHED":return"#28a745";case"IN_PROGRESS":return"#007bff";default:return"#6c757d"}};return o?window.SP_REACT.createElement(t.ModalRoot,{closeModal:e},window.SP_REACT.createElement("div",{style:{padding:"20px",minWidth:"600px",minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center"}},"Loading game ratings...")):n?window.SP_REACT.createElement(t.ModalRoot,{closeModal:e},window.SP_REACT.createElement("div",{style:{padding:"20px",minWidth:"900px",minHeight:"700px",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column"}},window.SP_REACT.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",marginTop:"20px",flexWrap:"wrap",gap:"15px"}},window.SP_REACT.createElement("h2",{style:{margin:0}},"Game Ratings"),window.SP_REACT.createElement("div",{style:{display:"flex",gap:"20px",alignItems:"center"}},window.SP_REACT.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},window.SP_REACT.createElement("label",{style:{fontSize:"14px",fontWeight:"bold",whiteSpace:"nowrap"}},"Show not finished games:"),window.SP_REACT.createElement("input",{type:"checkbox",checked:s,onChange:e=>p(e.target.checked),style:{width:"18px",height:"18px",cursor:"pointer"}})),window.SP_REACT.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},window.SP_REACT.createElement("label",{style:{fontSize:"14px",fontWeight:"bold",whiteSpace:"nowrap"}},"Year:"),window.SP_REACT.createElement("select",{value:m,onChange:e=>g(e.target.value),style:{padding:"5px 10px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",backgroundColor:"#2a2a2a",color:"#fff"}},window.SP_REACT.createElement("option",{value:"all"},"За всё время"),w.map(e=>window.SP_REACT.createElement("option",{key:e,value:e},e)))))),window.SP_REACT.createElement("div",{style:{flex:1,overflowY:"auto",border:"1px solid #333",borderRadius:"4px"}},0===n.total_games?window.SP_REACT.createElement("div",{style:{padding:"20px",textAlign:"center",color:"#666"}},"No games with ratings found. Write some reviews first!"):n.status_order.map(t=>{const a=n.grouped_by_status[t];return a&&0!==a.length?window.SP_REACT.createElement("div",{key:t},window.SP_REACT.createElement("div",{style:{padding:"10px 15px",backgroundColor:"#2a2a2a",borderBottom:"1px solid #444",fontSize:"16px",fontWeight:"bold",color:"#fff"}},"FINISHED"===t?"Пройденные":"SKIPPED"===t?"Пропущенные":"IN_PROGRESS"===t?"В процессе":t," (",a.length," games)"),a.map(t=>{return window.SP_REACT.createElement("div",{key:t.app_id,style:{display:"flex",alignItems:"center",padding:"15px",borderBottom:"1px solid #333",backgroundColor:"#1a1a1a",cursor:"pointer"},onClick:()=>{SteamUIStore.Navigate(`/library/app/${t.app_id}`),e()}},window.SP_REACT.createElement("div",{style:{width:"32px",height:"32px",marginRight:"15px",borderRadius:"4px",overflow:"hidden",backgroundColor:"#333",display:"flex",alignItems:"center",justifyContent:"center"}},t.icon_hash?window.SP_REACT.createElement("img",{src:`http://media.steampowered.com/steamcommunity/public/images/apps/${t.app_id}/${t.icon_hash}.jpg`,alt:t.display_name,style:{width:"100%",height:"100%",objectFit:"cover"},onError:e=>{e.target.style.display="none"}}):window.SP_REACT.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#666",fontSize:"12px"}},"?")),window.SP_REACT.createElement("div",{style:{minWidth:"80px",textAlign:"center",marginRight:"15px"}},window.SP_REACT.createElement("div",{style:{fontSize:"24px",fontWeight:"bold",color:(a=t.rating,a<=2?"#dc3545":a<=3.5?"#ffc107":a<=4.5?"#28a745":"#007bff")}},t.rating,"/5")),window.SP_REACT.createElement("div",{style:{flex:1,marginRight:"15px"}},window.SP_REACT.createElement("div",{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"4px"}},t.display_name),t.review&&window.SP_REACT.createElement("div",{style:{fontSize:"12px",color:"#aaa",maxHeight:"40px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},t.review)),window.SP_REACT.createElement("div",{style:{minWidth:"120px",textAlign:"center"}},window.SP_REACT.createElement("div",{style:{padding:"4px 8px",borderRadius:"12px",fontSize:"12px",fontWeight:"bold",backgroundColor:_(t.status),color:"white",display:"inline-block",marginBottom:"4px"}},c.find(e=>e.value===t.status)?.label),window.SP_REACT.createElement("div",{style:{fontSize:"11px",color:"#888"}},t.finished_at?`Finished: ${n=t.finished_at,n?new Date(1e3*n).toLocaleDateString():""}`:"")));var n,a})):null})),window.SP_REACT.createElement("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#2a2a2a",borderRadius:"4px",textAlign:"center"}},window.SP_REACT.createElement("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center"}},window.SP_REACT.createElement("div",null,window.SP_REACT.createElement("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#007bff"}},n.total_games),window.SP_REACT.createElement("div",{style:{fontSize:"12px",color:"#aaa"}},"Total Games")),window.SP_REACT.createElement("div",null,window.SP_REACT.createElement("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#28a745"}},n.ratings.filter(e=>"FINISHED"===e.status).length),window.SP_REACT.createElement("div",{style:{fontSize:"12px",color:"#aaa"}},"Finished")),window.SP_REACT.createElement("div",null,window.SP_REACT.createElement("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#6c757d"}},n.ratings.filter(e=>"SKIPPED"===e.status).length),window.SP_REACT.createElement("div",{style:{fontSize:"12px",color:"#aaa"}},"Skipped")),window.SP_REACT.createElement("div",null,window.SP_REACT.createElement("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#ffc107"}},n.ratings.filter(e=>"FINISHED"===e.status).length>0?(n.ratings.filter(e=>"FINISHED"===e.status).reduce((e,t)=>e+t.rating,0)/n.ratings.filter(e=>"FINISHED"===e.status).length).toFixed(1):"0.0"),window.SP_REACT.createElement("div",{style:{fontSize:"12px",color:"#aaa"}},"Avg Finished Rating")))))):window.SP_REACT.createElement(t.ModalRoot,{closeModal:e},window.SP_REACT.createElement("div",{style:{padding:"20px",minWidth:"600px",minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center",color:"#666"}},"No data available"))},u="SP Desktop_uid0";async function _(e){if(await r({message:`OnPopupCreation called with popup: ${e?.m_strName}`}),e.m_strName===u){await r({message:"Main popup detected, initializing..."}),await r({message:"Steam Game Helper plugin initialized"});try{await r({message:"Adding Game Helper menu item to Steam navbar..."});const n=e.m_popup.document.querySelectorAll("._2Lu3d-5qLmW4i19ysTt2jT._2UyOBeiSdBayaFdRa39N2O");if(n.length>0){await r({message:`Found ${n.length} existing menu items`});const a=n[n.length-1],i=a.parentNode;if(i.querySelector(".game-helper-menu-item"))return void await r({message:"Game Helper menu item already exists"});const o=e.m_popup.document.createElement("div");o.className="_2Lu3d-5qLmW4i19ysTt2jT _2UyOBeiSdBayaFdRa39N2O game-helper-menu-item";const l=n[0];if(l){const e=window.getComputedStyle(l);o.style.cssText=e.cssText,o.style.cursor="pointer",o.style.userSelect="none"}if(l&&l.children.length>0){const e=l.children[0].cloneNode(!0),t=e.querySelector(".bSKGlAJG2UVWTsntEJY2v");t&&(t.textContent="Game Helper"),o.appendChild(e)}else o.innerHTML='\n                    <div class="">\n                        <div class="bSKGlAJG2UVWTsntEJY2v">Game Helper</div>\n                    </div>\n                ';o.addEventListener("click",async n=>{n.preventDefault(),n.stopPropagation(),await r({message:"Game Helper menu clicked"}),t.showContextMenu(window.SP_REACT.createElement(t.Menu,{label:"Game Helper"},window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{await r({message:"Rating menu clicked"}),t.showModal(window.SP_REACT.createElement(w,{onClose:()=>{}}),e.m_popup.window,{strTitle:"Game Ratings",bHideMainWindowForPopouts:!1,bForcePopOut:!0,popupHeight:800,popupWidth:1e3})}},"Rating")),o,{bForcePopup:!0,bOverlapHorizontal:!0})}),o.addEventListener("dblclick",async n=>{await r({message:"Game Helper double-click triggered (fallback)"}),t.showModal(window.SP_REACT.createElement(w,{onClose:()=>{}}),e.m_popup.window,{strTitle:"Game Ratings (Fallback)",bHideMainWindowForPopouts:!1,bForcePopOut:!0,popupHeight:800,popupWidth:1e3})}),i.insertBefore(o,a.nextSibling),await r({message:"Game Helper menu item added successfully"})}else{await r({message:"No existing menu items found, trying alternative approach"});const n=await p("._1Ky59qmywxOUtNcI1cgmkX._3s0lkohH8wU2do0K1il28Y",e.m_popup.document);if(n){const a=e.m_popup.document.createElement("div");a.className="_2Lu3d-5qLmW4i19ysTt2jT _2UyOBeiSdBayaFdRa39N2O game-helper-menu-item",a.innerHTML='\n                    <div class="">\n                        <div class="bSKGlAJG2UVWTsntEJY2v">Game Helper</div>\n                    </div>\n                ',a.addEventListener("contextmenu",async n=>{n.preventDefault(),t.showContextMenu(window.SP_REACT.createElement(t.Menu,{label:"Game Helper"},window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{t.showModal(window.SP_REACT.createElement(w,{onClose:()=>{}}),e.m_popup.window,{strTitle:"Game Ratings",bHideMainWindowForPopouts:!1,bForcePopOut:!0,popupHeight:800,popupWidth:1e3})}},"Rating")))}),n.appendChild(a),await r({message:"Game Helper menu item added via alternative method"})}else await r({message:"Warning: Could not find navbar container"})}}catch(e){await r({message:`Error adding Game Helper menu: ${e}`})}for(var a=void 0;!a;)try{a=MainWindowBrowserManager}catch(e){await t.sleep(100)}MainWindowBrowserManager.m_browser.on("finished-request",async(a,i)=>{const o=MainWindowBrowserManager.m_lastLocation.pathname;if(o.startsWith("/library/app/")){const n=o.match(/\/library\/app\/(\d+)/);if(n){const a=parseInt(n[1]);try{const n=await p(`div.${t.findModule(e=>e.InPage).InPage} div.${t.findModule(e=>e.AppButtonsContainer).AppButtonsContainer} > div.${t.findModule(e=>e.MenuButtonContainer).MenuButtonContainer}:not([role="button"])`,e.m_popup.document);if(n&&!n.parentNode.querySelector("div.steam-game-helper-review-button")){const i=n.cloneNode(!0);i.classList.add("steam-game-helper-review-button"),i.firstChild&&(i.firstChild.innerHTML="📝"),i.title="Write Review",n.parentNode.insertBefore(i,n.nextSibling),i.addEventListener("click",async()=>{t.showModal(window.SP_REACT.createElement(g,{appId:a,onClose:()=>{}}),e.m_popup.window,{strTitle:"Game Review",bHideMainWindowForPopouts:!1,bForcePopOut:!0,popupHeight:620,popupWidth:600})})}}catch(e){}}}else if(o.startsWith("/library/collection/")){const a=uiStore.currentGameListSelection.strCollectionId;try{const i=await p(`div.${t.findModule(e=>e.CollectionOptions).CollectionOptions}`,e.m_popup.document);if(i){const o=i.querySelector("button.steam-game-helper-wheel-button");o&&o.parentNode?.removeChild(o);const l=e.m_popup.document.createElement("div");n.render(window.SP_REACT.createElement(t.DialogButton,{className:"steam-game-helper-wheel-button",style:{width:"40px",marginLeft:"3px",marginRight:"3px",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px",fontWeight:"bold"}},"🎯"),l),i.insertBefore(l,i.firstChild.nextSibling),l.addEventListener("click",async()=>{try{const n=collectionStore.GetCollection(a.replace("%20"," "));if(n&&n.allApps){const i=n.allApps.map(e=>({appid:e.appid,display_name:e.display_name,header_filename:e.library_capsule_filename,installed:e.installed||e.per_client_data&&e.per_client_data.installed}));i.length>0&&t.showModal(window.SP_REACT.createElement(m,{key:`fortune-wheel-${a}-${Date.now()}`,games:i,onClose:()=>{}}),e.m_popup.window,{strTitle:`Fortune Wheel - ${a}`,bHideMainWindowForPopouts:!1,bForcePopOut:!0,popupHeight:734,popupWidth:990})}}catch(e){}})}}catch(e){}}})}else await r({message:`Not main popup, ignoring: ${e?.m_strName}`})}return e.default=async function(){await App.WaitForServicesInitialized();const e=g_PopupManager.GetExistingPopup(u);e&&_(e),g_PopupManager.AddPopupCreatedCallback(_)},Object.defineProperty(e,"__esModule",{value:!0}),e}({},window.MILLENNIUM_API,window.SP_REACTDOM,window.SP_REACT)};function ExecutePluginModule(){let e=window.MILLENNIUM_PLUGIN_SETTINGS_STORE[pluginName];e.OnPluginConfigChange=function(t,n,a){t in e.settingsStore&&(e.ignoreProxyFlag=!0,e.settingsStore[t]=a,e.ignoreProxyFlag=!1)},MILLENNIUM_BACKEND_IPC.postMessage(0,{pluginName:pluginName,methodName:"__builtins__.__millennium_plugin_settings_parser__"}).then(async t=>{"string"==typeof t.returnValue&&(e.ignoreProxyFlag=!0,e.settingsStore=e.DefinePluginSetting(Object.fromEntries(JSON.parse(atob(t.returnValue)).map(e=>[e.functionName,e]))),e.ignoreProxyFlag=!1);let n=PluginEntryPointMain();Object.assign(window.PLUGIN_LIST[pluginName],{...n,__millennium_internal_plugin_name_do_not_use_or_change__:pluginName});let a=await n.default();var i;a&&(i=a)&&void 0!==i.title&&void 0!==i.icon&&void 0!==i.content?(window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS[pluginName]=a,MILLENNIUM_BACKEND_IPC.postMessage(1,{pluginName:pluginName})):console.warn(`Plugin ${pluginName} does not contain proper SidebarNavigation props and therefor can't be mounted by Millennium. Please ensure it has a title, icon, and content.`)})}ExecutePluginModule();